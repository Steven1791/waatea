{% load static %}
<html lang="en">
  <head>
    <title>Waatea RC Winterthur</title>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
       <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>


  </head>
<body>
{% block page_content %}
<a href="/"><img src="{% static 'images/rcwlogo.jpg' %}"></a>
<h1>Availability</h1>
{% if not request.user.is_authenticated %}
<a href="/">Login first</a>


{% else %}

Welcome {{request.user.name }}
<hr>






<div class="row">

{% for availability in view.getgamelist %}

    <div class="col-md-4">

        <div class="card mb-2">

            <div class="card-body">

              <h5 class="card-title">{{ availability.gameday.date }}</h5>
              {% for game in availability.gameday.games.all %}
                 <p class="card-text">  {{ game.home }} vs {{ game.away }}</p>
                 <p class="card-text">{{ game.team }} // {{ game.time }}</p>
              {% endfor %}


                {% if availability.state == 0 %}
                  <button class="availbutton ui circular green icon button" id="availbutton0{{ availability.id }}" data-val=0 data-catid="{{ availability.id }}">
                {% else %}
                  <button class="availbutton ui circular red icon button" id="availbutton0{{ availability.id }}" data-val=0 data-catid="{{ availability.id }}">
                {% endif %}
                  <i class="hourglass half icon huge"></i>
                </button>

                {% if availability.state == 3 %}
                  <button class="availbutton ui circular green icon button" id="availbutton1{{ availability.id }}" data-val=3 data-catid="{{ availability.id }}">
                {% else %}
                  <button class="availbutton ui circular red icon button" id="availbutton1{{ availability.id }}" data-val=3 data-catid="{{ availability.id }}">
                {% endif %}
                  <i class="thumbs up icon huge"></i>
                </button>
&nbsp;&nbsp;
                {% if availability.state == 1 %}
                  <button class="availbutton ui circular green icon button" id="availbutton2{{ availability.id }}" data-val=1 data-catid="{{ availability.id }}">
                {% else %}
                  <button class="availbutton ui circular red icon button" id="availbutton2{{ availability.id }}" data-val=1 data-catid="{{ availability.id }}">
                {% endif %}
                  <i class="question circle icon huge"></i>
                </button>

                {% if availability.state == 2 %}
                  <button class="availbutton ui circular green icon button" id="availbutton3{{ availability.id }}" data-val=2 data-catid="{{ availability.id }}">
                {% else %}
                  <button class="availbutton ui circular red icon button" id="availbutton3{{ availability.id }}" data-val=2 data-catid="{{ availability.id }}">
                {% endif %}
                  <i class="thumbs down icon huge"></i>
                </button>
            </div>

        </div>

    </div>

    {% endfor %}

</div>

{% endif %}

{% endblock %}

</body>


<script type="text/javascript">
$('.availbutton').click(function(){
  var id = $(this).attr("data-catid");
  var value = $(this).attr("data-val");
  if (value != 0)
  {
    SetAvail(id, value, $(this));
  }

});


function SetAvail(id, value, object)
{

$.ajax(
{
    type:"GET",
    url: "toggleavail",
    data:{
             post_id: id,
             post_value: value
},
success: function( data )
{
    $( '#availbutton0'+ id ).removeClass('availbutton ui circular green icon button');
    $( '#availbutton1'+ id ).removeClass('availbutton ui circular green icon button');
    $( '#availbutton2'+ id ).removeClass('availbutton ui circular green icon button');
    $( '#availbutton3'+ id ).removeClass('availbutton ui circular green icon button');
    $( '#availbutton0'+ id ).addClass('availbutton ui circular red icon button');
    $( '#availbutton1'+ id ).addClass('availbutton ui circular red icon button');
    $( '#availbutton2'+ id ).addClass('availbutton ui circular red icon button');
    $( '#availbutton3'+ id ).addClass('availbutton ui circular red icon button');
    object[0].className = ('availbutton ui circular green icon button');
    } }) };
</script>
